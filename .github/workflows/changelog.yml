name: Generate Changelog
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  generate-changelog:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # Ensure it has permission to modify the repository contents
      pull-requests: write  # Permissions to modify pull request-related data
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch full history for accurate changelog generation

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'  # Set the desired Python version

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt  # Ensure you have the required dependencies for changelog generation

      - name: Generate Changelog
        run: |
          # Command to generate the changelog (this can vary based on your changelog tool)
          python generate_changelog.py  # Replace with the actual command to generate changelog

      - name: Commit and push Changelog
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add CHANGELOG.md
          git commit -m "Update changelog"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # Token to authenticate GitHub actions for pushing changes
